# EZT_Office

## üìö Content

- üöÄ [Install](#-install)
- ‚öôÔ∏è [Setup Library](#-setup-library)
- üîß [Core Functions](#-core-functions)
- üí° [Usage Examples](#-usage-examples)

---

## üöÄ Install

### üîπ Trong `settings.gradle.kts` ho·∫∑c `build.gradle` c·∫•p project

```groovy
repositories {
    google()
    mavenCentral()
    maven {
        name = "GitHubPackages"
        url = uri("https://maven.pkg.github.com/TanhB02/EZT_Office")
        credentials {
            username = providers.gradleProperty("gpr.user")
                .orElse(System.getenv("GITHUB_ACTOR") ?: "")
                .get()
            password = providers.gradleProperty("gpr.token")
                .orElse(System.getenv("GITHUB_TOKEN") ?: "")
                .get()
        }
    }
}
```

### üîπ `gradle.properties`

```properties
gpr.user=TanhB02
gpr.token=
```

### üîπ `build.gradle` (Module: app)

```groovy
dependencies {
    implementation "ezt.documents:libreoffice:release_version"
}
```

---

### üîß Core Functions

| Function | M√¥ t·∫£ | Return |
|----------|-------|--------|
| `openFile(uri: Uri?, onClosed: (() -> Unit)? = null)` | M·ªü file b·∫±ng LibreOffice (`LOActivity`). T·ª± ƒë·ªông c·∫•p quy·ªÅn URI v√† ƒëƒÉng k√Ω callback khi LibreOffice b·ªã ƒë√≥ng. | `Unit` |
| `createFile(fileName: String, fileType: String = "xlsx", onClosed: (() -> Unit)? = null)` | T·∫°o file m·ªõi trong `MediaStore` t·ª´ template c√≥ s·∫µn, sau ƒë√≥ t·ª± ƒë·ªông m·ªü b·∫±ng LibreOffice. | `suspend Unit` |
| `openSystemPicker()` | M·ªü tr√¨nh ch·ªçn file h·ªá th·ªëng (`ACTION_OPEN_DOCUMENT`) v·ªõi danh s√°ch MIME types h·ªó tr·ª£. T·ª± ƒë·ªông fallback sang `ACTION_GET_CONTENT` n·∫øu c·∫ßn. | `Unit` |
| `pickAndOpenDocument()` | G·ªçi system picker ƒë·ªÉ ch·ªçn v√† m·ªü t√†i li·ªáu. Y√™u c·∫ßu `registerDocumentPicker()` ƒë∆∞·ª£c g·ªçi tr∆∞·ªõc trong `Activity`. | `Unit` |
| `registerDocumentPicker()` | ƒêƒÉng k√Ω launcher cho `ActivityResultContracts.OpenDocument`. Khi ng∆∞·ªùi d√πng ch·ªçn file, h√†m s·∫Ω t·ª± ƒë·ªông m·ªü file b·∫±ng LibreOffice. | `Unit` |

---

### üí° Usage Examples

D∆∞·ªõi ƒë√¢y l√† c√°c v√≠ d·ª• h∆∞·ªõng d·∫´n chi ti·∫øt c√°ch s·ª≠ d·ª•ng c√°c h√†m trong `UtilsOffice`.

---

#### üîπ 1. M·ªü file LibreOffice c√≥ s·∫µn  

D√πng khi b·∫°n ƒë√£ c√≥ `Uri` c·ªßa file c·∫ßn m·ªü.  
H√†m n√†y t·ª± ƒë·ªông c·∫•p quy·ªÅn truy c·∫≠p v√† m·ªü file b·∫±ng `LibreOffice (LOActivity)`.

```kotlin
val fileUri: Uri = ... // Uri c·ªßa t√†i li·ªáu c·∫ßn m·ªü
UtilsOffice.openFile(fileUri) {
    Log.d("App", "LibreOffice ƒë√£ ƒë√≥ng.")
}
```

---

#### üîπ 2. T·∫°o file m·ªõi v√† m·ªü b·∫±ng LibreOffice  

D√πng khi b·∫°n mu·ªën t·∫°o file m·ªõi d·ª±a tr√™n template trong th∆∞ m·ª•c `assets/templates/`  
v√† m·ªü tr·ª±c ti·∫øp b·∫±ng LibreOffice.  
H√†m n√†y l√† `suspend`, c·∫ßn ƒë∆∞·ª£c g·ªçi trong coroutine (v√≠ d·ª•: `lifecycleScope.launch`).

```kotlin
lifecycleScope.launch {
    UtilsOffice.createFile(
        fileName = "NewReport",
        fileType = "xlsx"
    ) {
        Log.d("App", "LibreOffice ƒë√£ ƒë√≥ng sau khi t·∫°o file m·ªõi.")
    }
}
```

---

#### üîπ 3. M·ªü tr√¨nh ch·ªçn file h·ªá th·ªëng (System Picker)  

D√πng khi b·∫°n mu·ªën cho ph√©p ng∆∞·ªùi d√πng ch·ªçn m·ªôt file t·ª´ b·ªô nh·ªõ h·ªá th·ªëng.  
H√†m s·∫Ω m·ªü system picker v·ªõi danh s√°ch MIME types h·ªó tr·ª£ nh∆∞ ODF, OOXML, PDF, CSV, v.v.  
N·∫øu thi·∫øt b·ªã kh√¥ng h·ªó tr·ª£ `ACTION_OPEN_DOCUMENT`, h√†m s·∫Ω t·ª± ƒë·ªông fallback sang `ACTION_GET_CONTENT`.  

> ‚ö†Ô∏è **L∆∞u √Ω:** Tr∆∞·ªõc khi g·ªçi `openSystemPicker()`, b·∫°n **ph·∫£i ƒëƒÉng k√Ω tr∆∞·ªõc** `registerDocumentPicker()` trong `onCreate()` c·ªßa Activity.

```kotlin
class MainActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        // Ph·∫£i g·ªçi tr∆∞·ªõc khi d√πng openSystemPicker()
        UtilsOffice.registerDocumentPicker()

        // Sau ƒë√≥ c√≥ th·ªÉ g·ªçi
        UtilsOffice.openSystemPicker()
    }
}
```

---

#### üîπ 4. Cho ph√©p ng∆∞·ªùi d√πng ch·ªçn v√† m·ªü t√†i li·ªáu ngay l·∫≠p t·ª©c  

D√πng khi b·∫°n mu·ªën ng∆∞·ªùi d√πng c√≥ th·ªÉ ch·ªçn file v√† m·ªü n√≥ ngay b·∫±ng LibreOffice.  
**Quan tr·ªçng:** Tr∆∞·ªõc khi s·ª≠ d·ª•ng, b·∫°n **B·∫ÆT BU·ªòC** ph·∫£i g·ªçi  
`UtilsOffice.registerDocumentPicker()` m·ªôt l·∫ßn trong `onCreate()` c·ªßa Activity ƒë·ªÉ ƒëƒÉng k√Ω launcher.

```kotlin
class MainActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        // 1. ƒêƒÉng k√Ω document picker m·ªôt l·∫ßn duy nh·∫•t
        UtilsOffice.registerDocumentPicker()

        // 2. G√°n s·ª± ki·ªán cho n√∫t m·ªü document picker
        findViewById<Button>(R.id.pickButton).setOnClickListener {
            // Ch·ªâ kh·ªüi ch·∫°y (launch) ·ªü ƒë√¢y
            UtilsOffice.pickAndOpenDocument()
        }
    }
}
```

---

#### üîπ 5. M·ªü file v√† l·∫Øng nghe s·ª± ki·ªán khi LibreOffice ƒë√≥ng  

D√πng khi b·∫°n c·∫ßn th·ª±c hi·ªán m·ªôt h√†nh ƒë·ªông sau khi ng∆∞·ªùi d√πng ƒë√≥ng t√†i li·ªáu LibreOffice,  
v√≠ d·ª• nh∆∞ l√†m m·ªõi UI, l∆∞u log, ho·∫∑c g·ª≠i d·ªØ li·ªáu analytics.

```kotlin
UtilsOffice.openFile(uri) {
    Toast.makeText(this, "LibreOffice ƒë√£ ƒë√≥ng, l√†m m·ªõi giao di·ªán...", Toast.LENGTH_SHORT).show()
}


